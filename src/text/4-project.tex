\section{Gammapy project} \label{sec:gammapy-project}

In this section, we provide an overview of the organization of the Gammapy
project. We briefly describe the main roles and responsibilities within the
team, as well as the technical infrastructure designed to facilitate the
development and maintenance of Gammapy as a high quality software. We use
common tools and services for software development of Python open-source
projects, code review, testing, package distribution and user support, with a
customized solution for a versioned thoroughly tested documentation in the form
of user-friendly playable tutorials. This section concludes with an outlook on
the roadmap for future directions.

\subsection{Organizational structure}
\label{ssec:organizational-structure}

Gammapy is a well-organised international open-source project with a broad
developer base and the presence of commitments from strong groups and
institutes in the very high-energies astrophysics
domain\footnote{\url{https://gammapy.org/team.html}}. The main development
roadmaps are discussed and validated by a Coordination Committee, composed of
representatives of the main contributing laboratories. This committee is
chaired by a Project Manager and his deputy while two Lead Developers manage
the development strategy and organise technical activities. Because of this
institutionally driven characteristic, the permanent staff and commitment of
supporting institutes ensure the continuity of the executive teams. A core team
of developers from the contributing laboratories is in charge of the regular
development, which benefits from punctual contributions of the community at
large.

\subsection{Technical infrastructure}
\label{ssec:technical-infrastructure}

Gammapy follows an open-source and open-contribution development model based on
the cloud repository service GitHub. A GitHub organization
\textit{gammapy}\footnote{\url{https://github.com/gammapy}} hosts different
repositories related with the project. The software codebase may be found in
the \textit{gammapy} repository (see Table~\ref{table:codestats:data} and
Figure~\ref{fig:codestats:lang} for code lines statistics). We make extensive
use of the pull request system to discuss and review code contributions.

\begin{table}
	\import{tables/generated/}{codestats}
	\caption{Coding languages statistics in Gammapy project}
	\label{table:codestats:data}
\end{table}

\begin{figure}[t]
	\centering
	\includegraphics[width=0.5\textwidth]{figures/codestats.pdf}
	\caption{
		Percentage of lines of code in Gammapy project} \label{fig:codestats:lang}
\end{figure}

Several automated tasks are set as GitHub
actions\footnote{\url{https://github.com/features/actions}}, blocking the
processes and alerting developers when fails occur. This is the case of the
content integration workflow, which monitors the execution of the test coverage
suite\footnote{\url{https://pytest.org}} using datasets from the
\textit{gammapy-data} repository. Tests scan not only the codebase but also the
code snippets present in docstrings of the scripts and in the RST documentation
files, as well as in the tutorials provided in the form of Jupyter notebooks.

Other automated tasks, executing in the \textit{gammapy-benchmarks} repository,
are responsible for numerical validation tests and benchmarks monitoring. Also
tasks related with the release process are partially automated, and every
contribution to the codebase repository triggers the documentation building and
publishing workflow within the \textit{gammapy-docs} repository (see Sec.
~\ref{ssec:software-distribution} and Sec. ~\ref{ssec:documentation}).

This small ecosystem of interconnected up-to-date repositories, automated tasks
and alerts, is just a part of a bigger set of GitHub repositories, where most
of them are related with the project but not necessary for the development of
the software (i.e., project webpage, complementary high-energy astrophysics
object catalogs, coding sprints and weekly developer calls minutes,
contributions to conferences, other digital assets, etc.) Finally, third-party
services for code quality metrics are also set and may be found as status
shields in the codebase repository.

\subsection{Software distribution}
\label{ssec:software-distribution}

Gammapy is distributed for Linux, Windows and Mac environments, and installed
in the usual way for Python packages. Each stable release is uploaded to the
Python package index\footnote{\url{https://pypi.org}} and as a binary package
to the \textit{conda-forge} and \textit{astropy} Anaconda
repository\footnote{\url{https://anaconda.org/anaconda/repo}} channels. At this
time, Gammapy is also available as a Debian Linux
package\footnote{\url{https://packages.debian.org/sid/python3-gammapy}}. We
recommend installing the software using the \textit{conda} installation process
with an environment definition file that we provide, so to work within a
virtual isolated environment with additional useful packages and ensure
reproducibility.

Gammapy is indexed in Astronomy Source Code
Library\footnote{\url{https://ascl.net/1711.014}} and
Zenodo\footnote{\url{https://zenodo.org/record/5721467o}} digital libraries for
software. The Zenodo record is synchronised with the codebase GitHub repository
so that every release triggers the update of the versioned record. In addition,
the next release of Gammapy will be added to the Open-source scientific
Software and Service Repository\footnote{\url{https://projectescape.eu/ossr}}
and indexed in the European Open Science Cloud
catalog\footnote{\url{https://eosc-portal.eu}}.

\subsection{Documentation and user-support}
\label{ssec:documentation-and-user-support}
Gammapy provides its user community with a tested and versioned up-to-date
on-line
documentation\footnote{\url{https://docs.gammapy.org}}~\citep{2019ASPC..523..357B}
built with Sphinx\footnote{\url{https://www.sphinx-doc.org}} scanning the
codebase Python scripts, as well as a set of RST files and Jupyter notebooks.
The documentation includes a handwritten user guide, a set of executable
tutorials, and a reference to the API automatically extracted from the code and
docstrings. The Gammapy code snippets present in the documentation are tested
in different environments using our continuous integration (CI) workflow based
on GitHub actions.

The Jupyter notebooks tutorials are stored stripped of their output cells,
which greatly helps in identifying differences in the contribution review.
During the CI these are executed, the output cells parsed and, in case an error
is found in one of the output cells then validation fails. Code formatting of
the input cells is also done, parsing their content and using a particular
syntax to provide links to the API documentation pages. The resulting web
published tutorials also provide links to playground spaces in
myBinder~\citep{project_jupyter-proc-scipy-2018}, where they may be executed
on-line in versioned virtual environments hosted in the myBinder
infrastructure. Users may also play with the tutorials locally in their
laptops. They can download a specific version of the tutorials together with
the associated datasets needed and the specific conda computing environment,
using the \textit{gammapy download} command.

We have also set up a solution for users to share recipes as Jupyter notebooks
that do not fit in the Gammapy core documentation but which may be relevant as
specific use cases. Contributions happen via pull requests to the
\textit{gammapy-recipes} GitHub repository and merged after a short review. All
notebooks in the repository are tested and published in the Gammapy recipes
webpage\footnote{\url{https://gammapy.github.io/gammapy-recipes}} automatically
using GitHub actions.

A growing community of users is gathering around the Slack
messaging\footnote{\url{https://gammapy.slack.com}} and GitHub
discussions\footnote{\url{https://github.com/gammapy/gammapy/discussions}}
support forums, providing valuable feedback on the Gammapy functionalities,
interface and documentation. Other communication channels have been set like
mailing lists, a Twitter account\footnote{\url{https://twitter.com/gammapyST}},
regular public coding sprint meetings, hands-on session within collaborations,
weekly development meetings, etc.

\subsection{Proposals for improving \gammapy}
\label{ssec:pigs}
An important part of \gammapy's development organisation is the support
for "Proposals for improving Gammapy" (PIG). This system is very much
inspired by Python's PEP\footnote{\url{https://peps.python.org/pep-0001/}}
and Astropy's APE \citep{greenfield_perry_2013} system.
PIG are self-contained documents which outline a set of larger
changes to the \gammapy code base. This includes larger feature additions,
code and package restructuring and maintenance as well as changes related
to the organisational structure of the \gammapy project. PIGs can be proposed
by any person in or outside the project and by multiple authors. They
are presented to the \gammapy developer community in a pull request
on GitHub and the undergo a review phase in which changes and
improvements to the document are proposed and implemented. Once the PIG
document is in a final state it is presented to the \gammapy
coordination committee, which takes the final decision on the
acceptance or rejection of the proposal. Once accepted, the proposed
change are implemented by \gammapy developers in a series of
individual contributions via pull requests. A list of all proposed
PIG documents is available in the \gammapy online documentation
\footnote{\url{https://docs.gammapy.org/0.20/development/pigs/index.html}}.

A special category of PIGs are long-term "roadmaps". To develop a common
vision for all \gammapy project members on the future of the
project, the main goals regarding planned features, maintenance and
project organisation are written up as an overview and presented to the
\gammapy community for discussion. The review and acceptance process
follows the normal PIG guidelines. Typically roadmaps are written
to outline and agree on a common vision for the next long term
support release of \gammapy.
